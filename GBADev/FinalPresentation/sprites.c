// managing sprites #include "../common/gba.h"#include "../common/sprite.h"#include "../common/sincosrad.h"#include "sprites.h"#include "rocket.h"#include "rlauncher.h"#include "utils.h"#include "physics.h"#include "environment.h"// sprites data#include "./Images/Sprites.c"#include "./Images/Enemy1.raw.c"#include "./Images/Enemy2.raw.c"#include "./Images/EnemyDie1.raw.c"#include "./Images/EnemyDie2.raw.c"#include "./Images/Rocket1.raw.c"#include "./Images/Rocket2.raw.c"#include "./Images/Rocket3.raw.c"#include "./Images/Launcher1.raw.c"#include "./Images/Launcher2.raw.c"#include "./Images/LauncherDie1.raw.c"#include "./Images/LauncherDie2.raw.c"int RocketCharAddresses[] = {512, 520, 528};int LauncherCharAddresses[] = {536, 544};int EnemyCharAddresses[] = {552, 560};int EnemyDieCharAddresses[] = {568, 576};int LauncherDieCharAddresses[] = {584, 592};void loadAllSpriteToOAMData(void){	u16* OAMDataLoc = OAMData + 8192; // I wanna use MODE_4	memcpy16(Rocket1_Bitmap, OAMDataLoc, ROCKET_SPRITE_SIZE*ROCKET_SPRITE_SIZE/2);	OAMDataLoc += ROCKET_SPRITE_SIZE*ROCKET_SPRITE_SIZE/2;	memcpy16(Rocket2_Bitmap, OAMDataLoc, ROCKET_SPRITE_SIZE*ROCKET_SPRITE_SIZE/2);	OAMDataLoc += ROCKET_SPRITE_SIZE*ROCKET_SPRITE_SIZE/2;	memcpy16(Rocket3_Bitmap, OAMDataLoc, ROCKET_SPRITE_SIZE*ROCKET_SPRITE_SIZE/2);	OAMDataLoc += ROCKET_SPRITE_SIZE*ROCKET_SPRITE_SIZE/2;	memcpy16(Launcher1_Bitmap, OAMDataLoc, LAUNCHER_SPRITE_SIZE*LAUNCHER_SPRITE_SIZE/2);	OAMDataLoc += LAUNCHER_SPRITE_SIZE*LAUNCHER_SPRITE_SIZE/2;	memcpy16(Launcher2_Bitmap, OAMDataLoc, LAUNCHER_SPRITE_SIZE*LAUNCHER_SPRITE_SIZE/2);	OAMDataLoc += LAUNCHER_SPRITE_SIZE*LAUNCHER_SPRITE_SIZE/2;	memcpy16(Enemy1_Bitmap, OAMDataLoc, ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2);	OAMDataLoc += ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2;	memcpy16(Enemy2_Bitmap, OAMDataLoc, ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2);	OAMDataLoc += ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2;	memcpy16(EnemyDie1_Bitmap, OAMDataLoc, ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2);	OAMDataLoc += ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2;	memcpy16(EnemyDie2_Bitmap, OAMDataLoc, ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2);	OAMDataLoc += ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2;		memcpy16(LauncherDie1_Bitmap, OAMDataLoc, ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2);	OAMDataLoc += ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2;	memcpy16(LauncherDie2_Bitmap, OAMDataLoc, ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2);	OAMDataLoc += ENEMY_SPRITE_SIZE*ENEMY_SPRITE_SIZE/2;}void initializeSprites(void){	setObjPalette(SPRITES_Palette);	loadAllSpriteToOAMData();	int i, j;//	Rocket	for(i = 0; i<ROCKET_NUMBER_OF_ENTITY; i++){		sprites[i].attribute0 = COLOR_256 | SQUARE | ROTATION_FLAG | 160;		sprites[i].attribute1 = SIZE_16 | ROTDATA(i) | 240;		sprites[i].attribute2 = RocketCharAddresses[0];		rotateSprite(i, 90, 1, 1);	}	//launcher	sprites[i].attribute0 = COLOR_256 | SQUARE | 160;	sprites[i].attribute1 = SIZE_16 | 240;	sprites[i].attribute2 = LauncherCharAddresses[0];		for(j = i + 1; j < i + ENEMY_NUMBER_OF_ENTITY + 1; j++){		sprites[j].attribute0 = COLOR_256 | SQUARE | 160;		sprites[j].attribute1 = SIZE_16 | 240;		sprites[j].attribute2 = EnemyCharAddresses[0];	}		for(; j < 128; j++){		sprites[j].attribute0 = 160;		sprites[j].attribute1 = 240;	}}void refreshSprites(){	memcpy16(sprites, OAM, 512);}void moveSprite(int spriteId, int x, int y){	sprites[spriteId].attribute1 &= 0xFF00;	sprites[spriteId].attribute0 &= 0xFF00;	sprites[spriteId].attribute1 |= x;	sprites[spriteId].attribute0 |= y;}void rotateSprite(int spriteId, int angle, int x_scale, int y_scale){	s32 pa,pb,pc,pd;	pa = (s32) ( x_scale * COS[angle]) >> 8;	pb = (s32) ( y_scale * SIN[angle]) >> 8;	pc = (s32) ( x_scale * -SIN[angle]) >> 8;	pd = (s32) ( y_scale * COS[angle]) >> 8;	rotData[spriteId].pa = pa;  //put them in my data struct	rotData[spriteId].pb = pb;	rotData[spriteId].pc = pc;	rotData[spriteId].pd = pd;}void hideSprite(int spriteId){	moveSprite(spriteId, 240, 160);}void setRocketAnimation(int rocketId, int frameId){	if (frameId < ROCKET_SPRITE_ANIM_NUM)		sprites[rocketId].attribute2 = RocketCharAddresses[frameId];}void setRocketLocation(int rocketId, int x, int y){	moveSprite(rocketId, x, y);}void setRocketAngle(int rocketId, int angle){	rotateSprite(rocketId, angle, 1, 1);}void setLauncherAnimation(int frameId){	if (frameId < LAUNCHER_SPRITE_ANIM_NUM)		sprites[ROCKET_NUMBER_OF_ENTITY].attribute2 = LauncherCharAddresses[frameId];}void setLauncherLocation(int x, int y){	moveSprite(ROCKET_NUMBER_OF_ENTITY, x, y);}void setLauncherDirection(int direction){	if (direction >= 0 ){		if(sprites[ROCKET_NUMBER_OF_ENTITY].attribute1 & HORIZONTAL_FLIP){			sprites[ROCKET_NUMBER_OF_ENTITY].attribute1 ^= HORIZONTAL_FLIP;		}	}	else if(direction < 0){		sprites[ROCKET_NUMBER_OF_ENTITY].attribute1 |= HORIZONTAL_FLIP;	}}void setEnemyAnimation(int enemyId, int frameId){	if (frameId < ENEMY_SPRITE_ANIM_NUM)		sprites[ROCKET_NUMBER_OF_ENTITY + 1 + enemyId].attribute2 = EnemyCharAddresses[frameId];}void setEnemyLocation(int enemyId, int x, int y){	moveSprite(ROCKET_NUMBER_OF_ENTITY + 1 + enemyId, x, y);}void setEnemyDieAnimation(int enemyId, int frameId){	if (frameId < ENEMY_SPRITE_ANIM_NUM)		sprites[ROCKET_NUMBER_OF_ENTITY + 1 + enemyId].attribute2 = EnemyDieCharAddresses[frameId];}void setLauncherDieAnimation(int enemyId, int frameId){	if (frameId < LAUNCHER_SPRITE_ANIM_NUM)		sprites[ROCKET_NUMBER_OF_ENTITY].attribute2 = LauncherDieCharAddresses[frameId];}